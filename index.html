<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="authors" content="Benji Antolin">
  <title>CLRWTR Insights</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Oswald&display=swap" rel="stylesheet">
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
  <link rel="stylesheet" href="css/MarkerCluster.css">
  <link rel="stylesheet" href="css/MarkerCluster.Default.css">
  <link rel="stylesheet" href="css/leaflet.zoomhome.css" />
  <link href="css/c3.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/simplebar.css" />
  <link rel="stylesheet" href="css/main.css">
  <link rel="icon" href="img/favicon.ico" type="image/x-icon">
  <script src="js/d3.js"></script>
  <script src="js/c3.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="js/chroma.min.js"></script>
  <script src="js/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="js/simplebar.min.js"></script>
  <script src="js/leaflet.markercluster.js"></script>
  <script src="js/leaflet.heat.js"></script>

  <script src="js/leaflet.zoomhome.min.js"></script>
  <script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
  <script src="https://unpkg.com/@asymmetrik/leaflet-d3@4/dist/leaflet-d3.js" charset="utf-8"></script>

  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
  <script src="https://rawgit.com/mapbox/mapbox-gl-leaflet/master/leaflet-mapbox-gl.js"></script>
</head>

<body>
  <main>
    <div class="loader"></div>
    <div id="info" data-simplebar data-simplebar-auto-hide="false">
      <!-- Header -->
      <div id="title" style="font-size:23px">
        <div id="deck-1" class="card-deck counts">
          <div class="card col-sm-2 ml-3 mr-1">
            <img src="img\clearLogo.png">
          </div>
          <div class="card col-sm-9">
            <div>CLRWTR Insights<sup>tm</sup></div>
            <div>Harmful Algal Blooms</div>
          </div>

          <!-- <span><a href="https://facebook.com/sharer.php?u=https://clrwtr-insights.github.io/detroit-lake/" target="_blank"><i class="fab fa-facebook-square"></i></a></span>
          <span><a href="https://github.com/clrwtr-insights/detroit-lake" target="_blank"><i class="fab fa-github-square"></i></a></span> -->
          <span><a data-toggle="modal" data-target="#resourcewindow"><i class="far fa-question-circle"></i></a></span>
          <span><a data-toggle="modal" data-target="#infowindow"><i class="nav fas fa-info-circle"></i></a></span>
        </div>

      </div>


      <!-- Location Title -->
      <p><span id="placename">Detroit Lake, Oregon</span> </p>
      <div> <span id="date"></span></div>
      <!-- Tab Data Selection -->
      <div id="deck-1" class="card-deck counts">

        <div class="card">
          <!-- tab list -->
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="weather-tab" data-bs-toggle="tab" href="#weather" data-bs-target="#weather" type="button" role="tab" aria-controls="weather" aria-selected="true">
                Weather <i class="fas fa-cloud-sun-rain"></i>
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="stream-tab" data-bs-toggle="tab" href="#stream" data-bs-target="#stream" type="button" role="tab" aria-controls="stream" aria-selected="false">
                Stream gage <i class="fas fa-tachometer-alt"></i>
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="sample-tab" data-bs-toggle="tab" href="#sample" data-bs-target="#sample" type="button" role="tab" aria-controls="sample" aria-selected="false">
                Water sample <i class="fas fa-vials"></i>
              </button>
            </li>
          </ul>
          <!-- tab content -->
          <div class="tab-content" id="myTabContent">
            <!-- weather tab -->
            <div class="tab-pane fade show" id="weather" role="tabpanel" aria-labelledby="weather-tab">
              <div id="deck-2" class="card-deck counts">
                <div class="card col-lg-11">
                  <div class="dropdown no-arrow">
                    <div class="nav-link " href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <span id="weatherText" class="dropdownTitle">Data taken from PRISM </span>
                    </div>
                  </div>
                </div>
                <div class="card col-lg-1 tabInfo mr-2">
                  <a data-toggle="modal" data-target="#prismInfoWindow"><i class="nav fas fa-info-circle"></i></a>
                </div>
              </div>

              <!-- <div class="dropdown no-arrow">
                <div class="nav-link">
                  <span id="weatherText" class="dropdownTitle">Data taken from PRISM </span>
                  <span><a data-toggle="modal" data-target="#prismInfoWindow"><i class="nav fas fa-info-circle"></i></a></span>
                </div>
              </div> -->
              <!-- Chart -->
              <div id="deck-2" class="card-deck counts">
                <div class="card">
                  <div id="precip-chart"></div>
                </div>
              </div>
              <div id="deck-2" class="card-deck counts">
                <div class="card">
                  <div id="airTemp-chart"></div>
                </div>
              </div>

              <!-- Variable Selection -->
              <!-- <div id="deck-4" class="card-deck counts">
                <div class="card">
                  <center>
                    <div class="form-check form-check-inline">
                      <label class="form-check-label">Variable: </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="inlineRadioOptionsW" id="inlineRadioW1" value="optionW1" checked>
                      <label class="form-check-label" for="inlineRadioW1">Ait temp.</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="inlineRadioOptionsW" id="inlineRadioW2" value="optionW2">
                      <label class="form-check-label" for="inlineRadioW2">Precip.</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="inlineRadioOptionsW" id="inlineRadioW3" value="optionW3">
                      <label class="form-check-label" for="inlineRadioW3">Wind speed</label>
                    </div>
                  </center>
                </div>
              </div> -->

            </div>
            <!-- Stream tab -->
            <div class="tab-pane fade show active" id="stream" role="tabpanel" aria-labelledby="stream-tab">
              <!-- Stream gage location dropdown -->
              <div id="deck-2" class="card-deck counts">
                <div class="card col-lg-11">
                  <div class="dropdown no-arrow">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <span class="mr-2 d-none d-lg-inline text-gray-600 small">Select Location:</span>
                      <span id="gageDropdown" class="dropdownTitle">NORTH SANTIAM RIVER AT NIAGARA, OR</span>
                    </a>

                    <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                      <center>
                        <a class="dropdown-item" id="14178000" value="1">NO SANTIAM R BLW BOULDER CRK, NR DETROIT, OR</a>
                        <a class="dropdown-item" id="14179000" value="2">BREITENBUSH R ABV FRENCH CR NR DETROIT, OR.</a>
                        <a class="dropdown-item" id="14180300" value="3">BLOWOUT CREEK NEAR DETROIT, OR</a>
                        <a class="dropdown-item" id="14181500" value="4">NORTH SANTIAM RIVER AT NIAGARA, OR</a>
                      </center>
                    </div>
                  </div>
                </div>
                <div class="card col-lg-1 tabInfo mr-2">
                  <a data-toggle="modal" data-target="#streamInfoWindow"><i class="nav fas fa-info-circle"></i></a>
                </div>
              </div>

              <!-- Chart -->
              <div id="deck-2" class="card-deck counts">
                <div class="card">
                  <center>
                    <p></p>
                  </center>
                  <div id="gage-chart"></div>
                </div>
              </div>
            </div>
            <!-- Sample tab -->
            <div class="tab-pane fade show" id="sample" role="tabpanel" aria-labelledby="sample-tab">
              <!-- Sample location dropdown -->
              <div id="deck-2" class="card-deck counts">
                <div class="card col-lg-11">
                  <div class="dropdown no-arrow">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <span class="mr-2 d-none d-lg-inline text-gray-600 small">Select Location:</span>
                      <span id="sampleDropdown" class="dropdownTitle">Log Boom</span>
                    </a>

                    <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                      <center>
                        <a class="dropdown-item" id="Log_Boom" value="1">Log Boom</a>
                        <a class="dropdown-item" id="Heater" value="2">Heater</a>
                        <a class="dropdown-item" id="Blowout" value="3">Blowout</a>
                      </center>
                    </div>
                  </div>
                </div>
                <div class="card col-lg-1 tabInfo mr-2">
                  <a data-toggle="modal" data-target="#sampleInfoWindow"><i class="nav fas fa-info-circle"></i></a>
                </div>
              </div>
              <!-- Chart -->
              <div id="deck-2" class="card-deck counts">
                <div class="card">
                  <div id="sub-chart"></div>
                  <center>
                    <p></p>
                  </center>
                  <div id="sample-chart"></div>
                </div>
              </div>
              <div id="deck-2" class="card-deck counts">
                <div class="card">
                  <center>
                    <p></p>
                  </center>
                  <div id="toxin-chart"></div>
                </div>
              </div>
              <div id="deck-2" class="card-deck counts">
                <div class="card">
                  <center>
                    <p></p>
                  </center>
                  <div id="nitrate-chart"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- Twitter Feed -->
      <!-- <div id="deck-5" class="card-deck counts">
        <div class="card">
          <a class="twitter-timeline" href="https://twitter.com/OHAOregon?ref_src=twsrc%5Etfw">Tweets by OHAOregon</a>
          <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        </div>
      </div> -->
    </div>
    </div>
    <!-- Map Element -->
    <div id="map"></div>
    <!-- Map Legend -->


    <!-- Sat data Panel -->
    <div id="sat-data-panel">


      <div class="card-deck legend m">
        <div class="card">
          <div>
            <div class="datePickerTitle">Satellite data <a data-toggle="modal" data-target="#satInfoWindow"><i class="nav fas fa-info-circle"></i></a></div>
            <div class="form-check form-check-inline">
              <label class="form-check-label" for="inlineRadio1">Satellite: </label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="inlineRadioOptions4" id="inlineRadio1" value="option1" checked>
              <label class="form-check-label" for="inlineRadio1">Sentinel 2a</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="inlineRadioOptions4" id="inlineRadio2" value="option2">
              <label class="form-check-label" for="inlineRadio2">Landsat 8</label>
            </div>
          </div>

          <div>
            <div class="form-check form-check-inline">
              <label class="form-check-label" for="inlineRadio1">Variable: </label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="inlineRadioOptions5" id="inlineRadio1" value="option1" checked>
              <label class="form-check-label" for="inlineRadio1">Chlorophyl a</label>
            </div>
          </div>
        </div>
      </div>
      <div class="card-deck legend">

        <div class="card">
          <div class="card-body legend-color-6">
            <h5 class="card-title" style="color:black">0</h5>

          </div>
        </div>

        <div class="card">
          <div class="card-body  legend-color-5">
            <h5 class="card-title" style="color:black">1-10</h5>

          </div>
        </div>
        <div class="card">
          <div class="card-body  legend-color-4">
            <h5 class="card-title" style="color:black">11-22</h5>

          </div>
        </div>

        <div class="card">
          <div class="card-body  legend-color-3">
            <h5 class="card-title" style="color:black">23-56</h5>

          </div>
        </div>

        <div class="card">
          <div class="card-body legend-color-2">
            <h5 class="card-title" style="color:black">57-151</h5>
          </div>
        </div>

        <div class="card">
          <div class="card-body legend-color-1">
            <h5 class="card-title" style="color:black">152+</h5>
          </div>
        </div>
      </div>
      <div class="card-deck legend">
        <div class="card">
          <div class="slidecontainer">
            <!-- <div id="hovered">
              <label>Hovered: </label>
              <span class="count"></span>
            </div>
            <div id="clicked">
              <label>Last Clicked: </label>
              <span class="count"></span>
            </div> -->
            <div class="timeTitle mb-1 mt-1">Date Picker</div>
            <input type="range" min="0" max="99" value="0" class="slider" id="myRange">
            <input id="d0" class="timeTitle ml-1 mb-1 mt-1 " type="date" min="2020-01-04" max="2021-08-26" value="2020-01-04">
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Modals -->
  <div id="infowindow" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="width:1250px!important">
      <div class="modal-content">
        <div class="modal-header">
          <strong class="modal-title" id="exampleModalLongTitle">Data Source & Attributions</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="demo" class="carousel " data-ride="carousel">
            <!-- <p>
              This online interactive map enables users to track both Oregon State and
              County trends of Novel Coronavirus infection since Feb 28th, 2020. The supporting
              dataset is collected daily and then plotted onto this web application.
            </p>
            <h5>Data Sources</h5>
            <p>
              Since March 18th, 2020 the Oregon COVID-19 Data is collected from
              <a href="https://govstatus.egov.com/OR-OHA-COVID-19" target="_blank">The Oregon Health Authority</a>(OHA)
              and then is plotted onto this web application.
            </p>
            <p>Data previous to March 18th was collected from the UW HGIS Lab <a href="https://hgis.uw.edu/virus/" target="_blank">Global COVID 19 Map</a> which has been collecting county and state level data from OHA and news sources since Feb 28th,
              2020.</p>
            <p>You can view the data (in CSV format) at <a href="http://benjiantolin.github.io/virusOregon/assets/timeseries/virusOregon.csv" target="_blank">here</a>.</p>
            <p>In the data table, each entry indicates Cases, Deaths, and Negative Test Results in the format of "#-#-#".</p>


            <p>County Polygon Data: <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html" target="_blank">U.S. Census Bureau Tiger/Line Shapefiles</a>
            </p>


            <h5>Update Procedure</h5>
            The Oregon state and county level COVID-19 data is currently being released daily from <a href="https://govstatus.egov.com/OR-OHA-COVID-19" target="_blank">OHA</a>. As data is released this application will continue to be updated.
            <h5>Acknowledgment</h5>
            <p>
              <li>Insipired by: Bo Zhao and UW HGIS Lab <a href="https://hgis.uw.edu/virus/" target="_blank">Global COVID 19 Map</a></li>
            </p>
            <div>
              * If you have any questions or concerns, please contact <a href="mailto:benjiantolin@gmail.com">Benji Antolin</a>.
            </div> -->
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="resourcewindow" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="width:1250px!important">
      <div class="modal-content">
        <div class="modal-header">
          <strong class="modal-title" id="exampleModalLongTitle">About Information</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="demo" class="carousel " data-ride="carousel">
            <p>About Information</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="prismInfoWindow" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="width:1250px!important">
      <div class="modal-content">
        <div class="modal-header">
          <strong class="modal-title" id="exampleModalLongTitle">PRISM Data Info</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="demo" class="carousel " data-ride="carousel">
            <p>PRISM Data Info.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="streamInfoWindow" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="width:1250px!important">
      <div class="modal-content">
        <div class="modal-header">
          <strong class="modal-title" id="exampleModalLongTitle">Stream gage data info</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="demo" class="carousel " data-ride="carousel">
            <p>Stream gage data info</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="sampleInfoWindow" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="width:1250px!important">
      <div class="modal-content">
        <div class="modal-header">
          <strong class="modal-title" id="exampleModalLongTitle">Water sample data info</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="demo" class="carousel " data-ride="carousel">
            <p>Water sample data info</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="satInfoWindow" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="width:1250px!important">
      <div class="modal-content">
        <div class="modal-header">
          <strong class="modal-title" id="exampleModalLongTitle">Satellite data info</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="demo" class="carousel " data-ride="carousel">
            <p>Satellite data info</p>
          </div>
        </div>
      </div>
    </div>
  </div>


  <script>
    $(window).ready(function() {
      $('.loader').fadeOut("slow");
    });


    $("#date").text("Last updated: 4/1/2020");


    // bounds of lake
    var lakeBounds = L.latLngBounds(
      L.latLng(44.61925641086582, -122.52700081495195), //Southwest
      L.latLng(44.789755, -122.025402), //Northeast
    );

    var mymap = L.map('map', {
      center: [44.70580544041939, -122.24899460193791],
      zoomControl: false,
      zoom: 12,
      maxZoom: 15,
      minZoom: 7,
      maxBounds: lakeBounds,
      maxBoundsViscosity: 1,
    });

    var voyager =
      L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}@2x.png');
    var satellite =
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');
    var USGS_USImagery = L.tileLayer('https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryOnly/MapServer/tile/{z}/{y}/{x}', {
      maxZoom: 20,
      attribution: 'Tiles courtesy of the <a href="https://usgs.gov/">U.S. Geological Survey</a>'
    }).addTo(mymap);



    var baseLayers = {
      'CartoDB Voyager': voyager,
      'ESRI Satellite': satellite,
      'USGS_USImagery': USGS_USImagery,
    }

    new L.control.layers(baseLayers, {
      // "Infection Level": areas,
      // "Infection Case(s) &nbsp;&nbsp; <i class='fas fa-users community'></i>": cases,
      // "Infected Community &nbsp;&nbsp; <i class='fas fa-procedures community'></i>": communities
    }, {
      collapsed: true
    }).addTo(mymap);

    new L.Control.zoomHome({
      position: 'topright'
    }).addTo(mymap);

    var chart, sampleChart, precipChart, airTempChart, toxinChart, nitrateChart;

    var colors = chroma.scale('Spectral').domain([0, 1]).padding(0.15).mode('lch').colors(6);
    var color = chroma.scale('Spectral').domain([0, 1]).padding(0.15).mode('lch').colors(6);

    for (i = 0; i < 6; i++) {
      $('head').append($("<style> .legend-color-" + (i + 1).toString() + " { background: " + color[i] + "; font-size: 15px; opacity: .6; text-shadow: 0 0 0px #ffffff;} </style>"));
    }

    // hexbin options
    var options = {
      radius: 12,
      opacity: 0.6,
      colorRange: [colors[5], colors[4], colors[3], colors[2], colors[1], colors[0]],
      duration: 500,
      radiusRange: [6, 11],
    };

    // hexbin map layer
    var hexLayer = L.hexbinLayer(options).addTo(mymap)

    // hexlayer options
    function tooltip_function(d) {

      var users_sum = d.reduce(function(acc, obj) {
        return (acc + parseFloat(obj["o"][2]));
      }, 0);

      avgChl = users_sum / d.length;
      avgChl = d3.format(".4")(avgChl);
      var tooltip_text = `Avg. Chlorophyll: ${String(avgChl)}`

      return tooltip_text
    }

    hexLayer
      .lng(function(d) {
        return d[0];
      })
      .lat(function(d) {
        return d[1];
      })
      .colorValue(
        function(d) {

          var sum = d.reduce(function(acc, obj) {
            return (acc + parseFloat(obj["o"][2]));
          }, 0);
          avgChl = sum / d.length;
          return avgChl
        }
      )
      .hoverHandler(L.HexbinHoverHandler.compound({
        handlers: [
          L.HexbinHoverHandler.resizeFill(),
          L.HexbinHoverHandler.tooltip({
            tooltipContent: tooltip_function
          })
        ]
      }));

    // Set up events
    hexLayer.dispatch()
      .on('mouseover', function(d, i) {
        console.log({
          type: 'mouseover',
          event: d,
          index: i,
          context: this
        });
        setHovered(d);
      })
      .on('mouseout', function(d, i) {
        console.log({
          type: 'mouseout',
          event: d,
          index: i,
          context: this
        });
        setHovered();
      })
      .on('click', function(d, i) {
        console.log({
          type: 'click',
          event: d,
          index: i,
          context: this
        });
        setClicked(d);
      });

    function setHovered(d) {
      d3.select('#hovered .count').text((null != d) ? d.length : '');
    }

    function setClicked(d) {
      d3.select('#clicked .count').text((null != d) ? d.length : '');
    }


    dateSelect = $('#d0').val();
    let [y, m, d] = dateSelect.split('-');
    mapYear = y;
    mapMonth = m;
    mapDay = d;
    mapDateString = mapYear + '_' + mapMonth + '_' + mapDay;
    // Parse date in YYYY-MM-DD format as local date
    function parseISOLocal(s) {
      let [y, m, d] = s.split('-');
      return new Date(y, m - 1, d);
    }

    // Format date as YYYY-MM-DD
    function dateToISOLocal(date) {
      let z = n => ('0' + n).slice(-2);
      return date.getFullYear() + '-' + z(date.getMonth() + 1) + '-' + z(date.getDate());
    }

    // Convert range slider value to date string
    function range2date(evt) {
      let dateInput = document.querySelector('#d0');
      let minDate = parseISOLocal(dateInput.defaultValue);
      minDate.setDate(minDate.getDate() + Number(this.value));
      dateInput.value = dateToISOLocal(minDate);
      dateSelect = $('#d0').val();
      let [y, m, d] = dateSelect.split('-');
      mapYear = y;
      mapMonth = m;
      mapDay = d;
      mapDateString = mapYear + '_' + mapMonth + '_' + mapDay;
      Promise.all([
        d3.csv('assets/satellite_map/detroit_lake_chlorophyll_' + mapDateString + '.csv'), //datasets[0]
      ]).then(function(datasets) {
        hexdata = [];
        datasets[0].forEach(function(d) {
          hexdata.push([
            d.lon,
            d.lat,
            d.Chlorophyll,
          ]);
        })
        hexLayer.data(hexdata);
      });
    }


    // Convert entered date to range
    function date2range(evt) {
      let date = parseISOLocal(this.value);
      let numDays = (date - new Date(this.min)) / 8.64e7;
      document.querySelector('#myRange').value = numDays;
      dateSelect = $('#d0').val();
      let [y, m, d] = dateSelect.split('-');
      mapYear = y;
      mapMonth = m;
      mapDay = d;
      mapDateString = mapYear + '_' + mapMonth + '_' + mapDay;

      Promise.all([
        d3.csv('assets/satellite_map/detroit_lake_chlorophyll_' + mapDateString + '.csv'), //datasets[0]
      ]).then(function(datasets) {
        hexdata = [];
        datasets[0].forEach(function(d) {
          hexdata.push([
            d.lon,
            d.lat,
            d.Chlorophyll,
          ]);
        })
        hexLayer.data(hexdata);
      });


    }

    window.onload = function() {
      let rangeInput = document.querySelector('#myRange');
      let dateInput = document.querySelector('#d0');
      // Get the number of days from the date min and max
      // Dates in YYYY-MM-DD format are treated as UTC
      // so will be exact whole days

      let rangeMax = (new Date(dateInput.max) - new Date(dateInput.min)) / 8.64e7;
      // Set the range min and max values
      rangeInput.min = 0;
      rangeInput.max = rangeMax;
      // Add listener to set the date input value based on the slider
      rangeInput.addEventListener('input', range2date, false);
      // Add listener to set the range input value based on the date
      dateInput.addEventListener('change', date2range, false);

    }



    Promise.all([
      d3.csv('assets/stream_gauge_tab/gage.csv'), //datasets[0]
      d3.json("assets/stream_gauge_tab/usgs.geojson"), //datasets[1]
      d3.csv('assets/water_sample_tab/algae.csv'), //datasets[2]
      d3.json("assets/water_sample_tab/ws.geojson"), //datasets[3]
      d3.csv('assets/satellite_map/detroit_lake_chlorophyll_' + mapDateString + '.csv'), //datasets[4]
      d3.csv('assets/weather_tab/detroit_lake_prism_2020_01_01_2021_09_15.csv'), //datasets[5]
      d3.csv('assets/water_sample_tab/toxin.csv'), //datasets[6]
      d3.csv('assets/water_sample_tab/nitrate.csv'), //datasets[7]
      d3.json("assets/weather_tab/weather.geojson"), //datasets[8]
      d3.csv('assets/water_sample_tab/algae/algae2016.csv'), //datasets[9]
      d3.csv('assets/water_sample_tab/algae/algae2017.csv'), //datasets[10]
      d3.csv('assets/water_sample_tab/algae/algae2018.csv'), //datasets[11]
      d3.csv('assets/water_sample_tab/algae/algae2019.csv'), //datasets[12]
      d3.csv('assets/water_sample_tab/toxin/toxin2016.csv'), //datasets[13]
      d3.csv('assets/water_sample_tab/toxin/toxin2017.csv'), //datasets[14]
      d3.csv('assets/water_sample_tab/toxin/toxin2018.csv'), //datasets[15]
      d3.csv('assets/water_sample_tab/toxin/toxin2019.csv'), //datasets[16]
      d3.csv('assets/water_sample_tab/nitrate/nitrate2016.csv'), //datasets[17]
      d3.csv('assets/water_sample_tab/nitrate/nitrate2017.csv'), //datasets[18]
      d3.csv('assets/water_sample_tab/nitrate/nitrate2018.csv'), //datasets[19]
      d3.csv('assets/water_sample_tab/nitrate/nitrate2019.csv'), //datasets[20]
      d3.csv('assets/stream_gauge_tab/gage2020.csv'), //datasets[21]
      d3.csv('assets/stream_gauge_tab/gage2021.csv'), //datasets[22]
      d3.csv('assets/weather_tab/prism2020.csv'), //datasets[23]
      d3.csv('assets/weather_tab/prism2021.csv'), //datasets[24]
    ]).then(function(datasets) {

      hexdata = [];
      datasets[4].forEach(function(d) {
        hexdata.push([
          d.lon,
          d.lat,
          d.Chlorophyll,
        ]);
      })
      hexLayer.data(hexdata);

      // prismPoints = hexdata.map(function(p) {
      //   return [p[0], p[1], p[2]];
      // });

      // Weather Data
      var wt = ["Date"];
      var wt2020 = ["Date"];
      var wt2021 = ["Date"];
      var precip = ["Precipitation"];
      var precip2020 = ["2020"];
      var precip2021 = ["2021"];
      var airTemp = ["Air Temperature"];
      var airTemp2020 = ["2020"];
      var airTemp2021 = ["2021"];

      var weatherVars = {
        name: "Precip",
        p: precip,
        p2020: precip2020,
        p2021: precip2021,
        a: airTemp,
        a2020: airTemp2020,
        a2021: airTemp2021,
      }

      function varsCounts(i) {
        tp = 0, ta = 0;
        datasets[5].forEach(function(d) {
          var USTd = new Date(d["date"])
          wt.push(USTd.setHours(USTd.getHours() + 8));
          tp = 0, ta = 0;
          current = d;
          delete current["date"];
          if (i["name"] = "Precip") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tp += +items[0];
                break;
            };

          }

          if (i["name"] = "Air_Temp") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta += +items[0];
                break;
            };

          }
          i["p"].push(tp);
          i["a"].push(ta);
        });
        tp2020 = 0, ta2020 = 0;
        datasets[23].forEach(function(d) {
          var USTd = new Date(d["date"])
          wt2020.push(USTd.setHours(USTd.getHours() + 8));
          tp2020 = 0, ta2020 = 0;
          current = d;
          delete current["date"];
          if (i["name"] = "Precip") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tp2020 += +items[0];
                break;
            };

          }

          if (i["name"] = "Air_Temp") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta2020 += +items[0];
                break;
            };

          }
          i["p2020"].push(tp2020);
          i["a2020"].push(ta2020);
        });
        tp2021 = 0, ta2021 = 0;
        datasets[24].forEach(function(d) {
          var USTd = new Date(d["date"])
          wt2021.push(USTd.setHours(USTd.getHours() + 8));
          tp2021 = 0, ta2021 = 0;
          current = d;
          delete current["date"];
          if (i["name"] = "Precip") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tp2021 += +items[0];
                break;
            };

          }

          if (i["name"] = "Air_Temp") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta2021 += +items[0];
                break;
            };

          }
          i["p2021"].push(tp2021);
          i["a2021"].push(ta2021);
        });
      }

      // Stream Gage Data
      var t = ["Date"];
      var t2020 = ["Date"];
      var t2021 = ["Date"];
      var water_temp = ["Water Temperature"];
      var water_temp2020 = ["2020"];
      var water_temp2021 = ["2021"];
      var gage1 = {
        name: "14178000",
        wt: water_temp,
        wt2020: water_temp2020,
        wt2021: water_temp2021,
      }

      function gage1Counts(i) {
        twt = 0;
        datasets[0].forEach(function(d) {
          var USTd = new Date(d["date"])
          t.push(USTd.setHours(USTd.getHours() + 8));
          twt = 0;
          current = d;
          delete current["date"];
          if (i["name"] = "14178000") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:

                twt += +items[0];
                break;
            };

          }
          i["wt"].push(twt);
        });
        twt2020 = 0;
        datasets[21].forEach(function(d) {
          var USTd = new Date(d["date"])
          t2020.push(USTd.setHours(USTd.getHours() + 8));
          twt2020 = 0;
          current = d;
          delete current["date"];
          if (i["name"] = "14178000") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:

                twt2020 += +items[0];
                break;
            };

          }
          i["wt2020"].push(twt2020);
        });
        twt2021 = 0;
        datasets[22].forEach(function(d) {
          var USTd = new Date(d["date"])
          t2021.push(USTd.setHours(USTd.getHours() + 8));
          twt2021 = 0;
          current = d;
          delete current["date"];
          if (i["name"] = "14178000") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:

                twt2021 += +items[0];
                break;
            };

          }
          i["wt2021"].push(twt2021);
        });


      }

      function siteCounts(i) {
        twt = 0;
        datasets[0].forEach(function(d) {
          var USTd = new Date(d["Date"])
          t.push(USTd.setHours(USTd.getHours() + 8));
          twt = 0;
          current = d;
          delete current["Date"];
          if (i["name"] != "14178000") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                twt += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  twt += +items[0];
                  break;
              };

            });
            //
          }
          i["wt"].push(twt);
        });
        twt2020 = 0;
        datasets[21].forEach(function(d) {
          var USTd = new Date(d["Date"])
          t2020.push(USTd.setHours(USTd.getHours() + 8));
          twt2020 = 0;
          current = d;
          delete current["Date"];
          if (i["name"] != "14178000") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                twt2020 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  twt2020 += +items[0];
                  break;
              };

            });
            //
          }
          i["wt2020"].push(twt2020);
        });
        twt2021 = 0;
        datasets[22].forEach(function(d) {
          var USTd = new Date(d["Date"])
          t2021.push(USTd.setHours(USTd.getHours() + 8));
          twt2021 = 0;
          current = d;
          delete current["Date"];
          if (i["name"] != "14178000") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                twt2021 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  twt2021 += +items[0];
                  break;
              };

            });
            //
          }
          i["wt2021"].push(twt2021);
        });


      }

      // Water sample Data
      var wst = ["Date"];
      var wst2016 = ["Date"];
      var wst2017 = ["Date"];
      var wst2018 = ["Date"];
      var wst2019 = ["Date"];
      var wstt = ["Date"];
      var wstt2016 = ["Date"];
      var wstt2017 = ["Date"];
      var wstt2018 = ["Date"];
      var wstt2019 = ["Date"];
      var wsnt = ["Date"];
      var wsnt2016 = ["Date"];
      var wsnt2017 = ["Date"];
      var wsnt2018 = ["Date"];
      var wsnt2019 = ["Date"];
      var algae = ["Algae"];
      var algae2016 = ["2016"];
      var algae2017 = ["2017"];
      var algae2018 = ["2018"];
      var algae2019 = ["2019"];
      var toxin = ["Toxins"];
      var toxin2016 = ["2016"];
      var toxin2017 = ["2017"];
      var toxin2018 = ["2018"];
      var toxin2019 = ["2019"];
      var nitrate = ["Total Nitrate"];
      var nitrate2016 = ["2016"];
      var nitrate2017 = ["2017"];
      var nitrate2018 = ["2018"];
      var nitrate2019 = ["2019"];

      var sampleLoc1 = {
        name: "Log Boom",
        a: algae,
        a2016: algae2016,
        a2017: algae2017,
        a2018: algae2018,
        a2019: algae2019,
        t: toxin,
        t2016: toxin2016,
        t2017: toxin2017,
        t2018: toxin2018,
        t2019: toxin2019,
        n: nitrate,
        n2016: nitrate2016,
        n2017: nitrate2017,
        n2018: nitrate2018,
        n2019: nitrate2019,

      }

      function sample1Counts(i) {
        // algae data
        ta = 0;
        datasets[2].forEach(function(d) {
          var USTd = new Date(d["t"])
          wst.push(USTd.setHours(USTd.getHours() + 8));
          ta = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta += +items[0];
                break;
            };

          }
          i["a"].push(ta);
        });
        ta2016 = 0;
        datasets[9].forEach(function(d) {
          var USTd = new Date(d["t"])
          wst2016.push(USTd.setHours(USTd.getHours() + 8));
          ta2016 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta2016 += +items[0];
                break;
            };

          }
          i["a2016"].push(ta2016);
        });
        ta2017 = 0;
        datasets[10].forEach(function(d) {
          var USTd = new Date(d["t"])
          wst2017.push(USTd.setHours(USTd.getHours() + 8));
          ta2017 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta2017 += +items[0];
                break;
            };

          }
          i["a2017"].push(ta2017);
        });
        ta2018 = 0;
        datasets[11].forEach(function(d) {
          var USTd = new Date(d["t"])
          wst2018.push(USTd.setHours(USTd.getHours() + 8));
          ta2018 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta2018 += +items[0];
                break;
            };

          }
          i["a2018"].push(ta2018);
        });
        ta2019 = 0;
        datasets[12].forEach(function(d) {
          var USTd = new Date(d["t"])
          wst2019.push(USTd.setHours(USTd.getHours() + 8));
          ta2019 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta2019 += +items[0];
                break;
            };

          }
          i["a2019"].push(ta2019);
        });
        // toxin data
        tt = 0;
        datasets[6].forEach(function(d) {
          var USTd = new Date(d["t"])
          wstt.push(USTd.setHours(USTd.getHours() + 8));
          tt = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tt += +items[0];
                break;
            };

          }
          i["t"].push(tt);
        });
        tt2016 = 0;
        datasets[13].forEach(function(d) {
          var USTd = new Date(d["t"])
          wstt2016.push(USTd.setHours(USTd.getHours() + 8));
          tt2016 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tt2016 += +items[0];
                break;
            };

          }
          i["t2016"].push(tt2016);
        });
        tt2017 = 0;
        datasets[14].forEach(function(d) {
          var USTd = new Date(d["t"])
          wstt2017.push(USTd.setHours(USTd.getHours() + 8));
          tt2017 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tt2017 += +items[0];
                break;
            };

          }
          i["t2017"].push(tt2017);
        });
        tt2018 = 0;
        datasets[15].forEach(function(d) {
          var USTd = new Date(d["t"])
          wstt2018.push(USTd.setHours(USTd.getHours() + 8));
          tt2018 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tt2018 += +items[0];
                break;
            };

          }
          i["t2018"].push(tt2018);
        });
        tt2019 = 0;
        datasets[16].forEach(function(d) {
          var USTd = new Date(d["t"])
          wstt2019.push(USTd.setHours(USTd.getHours() + 8));
          tt2019 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tt2019 += +items[0];
                break;
            };

          }
          i["t2019"].push(tt2019);
        });
        // nitrate data
        tn = 0;
        datasets[7].forEach(function(d) {
          var USTd = new Date(d["t"])
          wsnt.push(USTd.setHours(USTd.getHours() + 8));
          tn = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tn += +items[0];
                break;
            };

          }
          i["n"].push(tn);
        });
        tn2016 = 0;
        datasets[17].forEach(function(d) {
          var USTd = new Date(d["t"])
          wsnt2016.push(USTd.setHours(USTd.getHours() + 8));
          tn2016 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tn2016 += +items[0];
                break;
            };

          }
          i["n2016"].push(tn2016);
        });
        tn2017 = 0;
        datasets[18].forEach(function(d) {
          var USTd = new Date(d["t"])
          wsnt2017.push(USTd.setHours(USTd.getHours() + 8));
          tn2017 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tn2017 += +items[0];
                break;
            };

          }
          i["n2017"].push(tn2017);
        });
        tn2018 = 0;
        datasets[19].forEach(function(d) {
          var USTd = new Date(d["t"])
          wsnt2018.push(USTd.setHours(USTd.getHours() + 8));
          tn2018 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tn2018 += +items[0];
                break;
            };

          }
          i["n2018"].push(tn2018);
        });
        tn2019 = 0;
        datasets[20].forEach(function(d) {
          var USTd = new Date(d["t"])
          wsnt2019.push(USTd.setHours(USTd.getHours() + 8));
          tn2019 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tn2019 += +items[0];
                break;
            };

          }
          i["n2019"].push(tn2019);
        });
      }

      function sampleSiteCounts(i) {
        // algae data
        ta = 0;
        datasets[2].forEach(function(d) {
          var USTd = new Date(d["t"])
          wst.push(USTd.setHours(USTd.getHours() + 8));
          ta = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  ta += +items[0];
                  break;
              };

            });
            //
          }
          i["a"].push(ta);
        });
        ta2016 = 0;
        datasets[9].forEach(function(d) {
          var USTd = new Date(d["t"])
          wst2016.push(USTd.setHours(USTd.getHours() + 8));
          ta2016 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta2016 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  ta2016 += +items[0];
                  break;
              };

            });
            //
          }
          i["a2016"].push(ta2016);
        });
        ta2017 = 0;
        datasets[10].forEach(function(d) {
          var USTd = new Date(d["t"])
          wst2017.push(USTd.setHours(USTd.getHours() + 8));
          ta2017 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta2017 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  ta2017 += +items[0];
                  break;
              };

            });
            //
          }
          i["a2017"].push(ta2017);
        });
        ta2018 = 0;
        datasets[11].forEach(function(d) {
          var USTd = new Date(d["t"])
          wst2018.push(USTd.setHours(USTd.getHours() + 8));
          ta2018 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta2018 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  ta2018 += +items[0];
                  break;
              };

            });
            //
          }
          i["a2018"].push(ta2018);
        });
        ta2019 = 0;
        datasets[12].forEach(function(d) {
          var USTd = new Date(d["t"])
          wst2019.push(USTd.setHours(USTd.getHours() + 8));
          ta2019 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                ta2019 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  ta2019 += +items[0];
                  break;
              };

            });
            //
          }
          i["a2019"].push(ta2019);
        });
        // toxin data
        tt = 0;
        datasets[6].forEach(function(d) {
          var USTd = new Date(d["t"])
          wstt.push(USTd.setHours(USTd.getHours() + 8));
          tt = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tt += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  tt += +items[0];
                  break;
              };

            });
            //
          }
          i["t"].push(tt);
        });
        tt2016 = 0;
        datasets[13].forEach(function(d) {
          var USTd = new Date(d["t"])
          wstt2016.push(USTd.setHours(USTd.getHours() + 8));
          tt2016 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tt2016 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  tt2016 += +items[0];
                  break;
              };

            });
            //
          }
          i["t2016"].push(tt2016);
        });
        tt2017 = 0;
        datasets[14].forEach(function(d) {
          var USTd = new Date(d["t"])
          wstt2017.push(USTd.setHours(USTd.getHours() + 8));
          tt2017 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tt2017 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  tt2017 += +items[0];
                  break;
              };

            });
            //
          }
          i["t2017"].push(tt2017);
        });
        tt2018 = 0;
        datasets[15].forEach(function(d) {
          var USTd = new Date(d["t"])
          wstt2018.push(USTd.setHours(USTd.getHours() + 8));
          tt2018 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tt2018 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  tt2018 += +items[0];
                  break;
              };

            });
            //
          }
          i["t2018"].push(tt2018);
        });
        tt2019 = 0;
        datasets[16].forEach(function(d) {
          var USTd = new Date(d["t"])
          wstt2019.push(USTd.setHours(USTd.getHours() + 8));
          tt2019 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tt2019 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  tt2019 += +items[0];
                  break;
              };

            });
            //
          }
          i["t2019"].push(tt2019);
        });
        // nitrate data
        tn = 0;
        datasets[7].forEach(function(d) {
          var USTd = new Date(d["t"])
          wsnt.push(USTd.setHours(USTd.getHours() + 8));
          tn = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tn += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  tn += +items[0];
                  break;
              };

            });
            //
          }
          i["n"].push(tn);
        });
        tn2016 = 0;
        datasets[17].forEach(function(d) {
          var USTd = new Date(d["t"])
          wsnt2016.push(USTd.setHours(USTd.getHours() + 8));
          tn2016 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tn2016 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  tn2016 += +items[0];
                  break;
              };

            });
            //
          }
          i["n2016"].push(tn2016);
        });
        tn2017 = 0;
        datasets[18].forEach(function(d) {
          var USTd = new Date(d["t"])
          wsnt2017.push(USTd.setHours(USTd.getHours() + 8));
          tn2017 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tn2017 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  tn2017 += +items[0];
                  break;
              };

            });
            //
          }
          i["n2017"].push(tn2017);
        });
        tn2018 = 0;
        datasets[19].forEach(function(d) {
          var USTd = new Date(d["t"])
          wsnt2018.push(USTd.setHours(USTd.getHours() + 8));
          tn2018 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tn2018 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  tn2018 += +items[0];
                  break;
              };

            });
            //
          }
          i["n2018"].push(tn2018);
        });
        tn2019 = 0;
        datasets[20].forEach(function(d) {
          var USTd = new Date(d["t"])
          wsnt2019.push(USTd.setHours(USTd.getHours() + 8));
          tn2019 = 0;
          current = d;
          delete current["t"];
          if (i["name"] = "Log Boom") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 1:
                tn2019 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 1:
                  tn2019 += +items[0];
                  break;
              };

            });
            //
          }
          i["n2019"].push(tn2019);
        });
      }


      function setColor(cases) {

        if (cases >= .874) {
          id = 4;
        } else if (cases > .795 && cases <= .874) {
          id = 3;
        } else if (cases > .742 && cases <= .795) {
          id = 2;
        } else if (cases > .655 && cases <= .742) {
          id = 1;
        } else if (cases > 0.006 && cases <= 0.655) {
          id = 0;
        } else {
          id = -1;
          return "#00000000";
        }

        return colors[id];

      }


      function style(feature) {

        return {
          fillColor: setColor(feature.properties.Cases),
          fillOpacity: 0.4,
          weight: 1,
          opacity: 1,
          color: '#b4b4b4',
          dashArray: '3'
        };

      }

      function sampleStyle(feature) {

        return {
          fillColor: setColor(feature.properties.Cases),
          fillOpacity: 0.4,
          weight: 1,
          opacity: 1,
          color: '#b4b4b4',
          dashArray: '3'
        };

      }

      function weatherStyle(feature) {

        return {
          fillColor: setColor(feature.properties.Cases),
          fillOpacity: 0.4,
          weight: 1,
          opacity: 1,
          color: '#b4b4b4',
          dashArray: '3'
        };

      }


      function highlightFeature(e) {
        // e indicates the current event
        var layer = e.target; //the target capture the object which the event associates with
        layer.setStyle({
          weight: 4,
          opacity: 0.8,
          color: '#e3e3e3',
          fillColor: '#00ffd9',
          fillOpacity: 0.1
        });
        // bring the layer to the front.
        layer.bringToFront();
      }

      // 3.2.2 zoom to the highlighted feature when the mouse is clicking onto it.
      // 3.2.2 zoom to the highlighted feature when the mouse is clicking onto it.
      function zoomToFeature(e) {
        // mymap.fitBounds(e.target.getBounds());
        L.DomEvent.stopPropagation(e);
        // $("#hint").text("Click here to for State trend.");


        var t = ["Date"];
        var t2020 = ["Date"];
        var t2021 = ["Date"];
        var water_temp = ["Water Temperature"];
        var water_temp2020 = ["2020"];
        var water_temp2021 = ["2021"];
        // var negTests = ["Negative Tests"];
        var siteSelect = {
          name: e.target.feature.properties.usgs_site,
          wt: water_temp,
          wt2020: water_temp2020,
          wt2021: water_temp2021,
        }

        siteCounts(siteSelect);


        chart.load({
          unload: true,
          columns: [siteSelect.wt2020, siteSelect.wt2021],
        });

        $("#gageDropdown").text(e.target.feature.properties.site_name);
      }


      function sampleZoomToFeature(e) {
        // mymap.fitBounds(e.target.getBounds());
        L.DomEvent.stopPropagation(e);
        // $("#hint").text("Click here to for State trend.");


        // Water sample Data
        var wst = ["Date"];
        var wst2016 = ["Date"];
        var wst2017 = ["Date"];
        var wst2018 = ["Date"];
        var wst2019 = ["Date"];
        var wstt = ["Date"];
        var wstt2016 = ["Date"];
        var wstt2017 = ["Date"];
        var wstt2018 = ["Date"];
        var wstt2019 = ["Date"];
        var wsnt = ["Date"];
        var wsnt2016 = ["Date"];
        var wsnt2017 = ["Date"];
        var wsnt2018 = ["Date"];
        var wsnt2019 = ["Date"];
        var algae = ["Algae"];
        var algae2016 = ["2016"];
        var algae2017 = ["2017"];
        var algae2018 = ["2018"];
        var algae2019 = ["2019"];
        var toxin = ["Toxins"];
        var toxin2016 = ["2016"];
        var toxin2017 = ["2017"];
        var toxin2018 = ["2018"];
        var toxin2019 = ["2019"];
        var nitrate = ["Total Nitrate"];
        var nitrate2016 = ["2016"];
        var nitrate2017 = ["2017"];
        var nitrate2018 = ["2018"];
        var nitrate2019 = ["2019"];

        var sampleLoc = {
          name: e.target.feature.properties.site,
          a: algae,
          a2016: algae2016,
          a2017: algae2017,
          a2018: algae2018,
          a2019: algae2019,
          t: toxin,
          t2016: toxin2016,
          t2017: toxin2017,
          t2018: toxin2018,
          t2019: toxin2019,
          n: nitrate,
          n2016: nitrate2016,
          n2017: nitrate2017,
          n2018: nitrate2018,
          n2019: nitrate2019,
        }


        sampleSiteCounts(sampleLoc);


        sampleChart.load({
          unload: true,
          columns: [sampleLoc.a2016, sampleLoc.a2017, sampleLoc.a2018, sampleLoc.a2019],
        });
        toxinChart.load({
          unload: true,
          columns: [sampleLoc.t2016, sampleLoc.t2017, sampleLoc.t2018, sampleLoc.t2019],
        });
        nitrateChart.load({
          unload: true,
          columns: [sampleLoc.n2016, sampleLoc.n2017, sampleLoc.n2018, sampleLoc.n2019],
        });

        $("#sampleDropdown").text(e.target.feature.properties.site);
      }


      // 3.2.3 reset the hightlighted feature when the mouse is out of its region.
      function resetHighlight(e) {
        county.resetStyle(e.target);

      }

      // 3.3 add these event the layer obejct.
      function onEachFeature(feature, layer) {
        layer.on({
            // mouseover: highlightFeature,
            click: zoomToFeature,
            // mouseout: resetHighlight
          }),
          layer.bindTooltip(feature.properties.site_name, {
            className: 'feature-label',
            permanent: false,
            sticky: true,
            direction: 'auto'
          });
      }

      // 3.3 add these event the layer obejct.
      function sampleOnEachFeature(feature, layer) {
        layer.on({
            // mouseover: highlightFeature,
            click: sampleZoomToFeature,
            // mouseout: resetHighlight
          }),
          layer.bindTooltip(feature.properties.site, {
            className: 'feature-label',
            permanent: false,
            sticky: true,
            direction: 'auto'
          });
      }
      // 3.3 add these event the layer obejct.
      function weatherOnEachFeature(feature, layer) {
        layer.on({
            // mouseover: highlightFeature,
            // click: sampleZoomToFeature,
            // mouseout: resetHighlight
          }),
          layer.bindTooltip(feature.properties.site, {
            className: 'feature-label',
            permanent: false,
            sticky: true,
            direction: 'auto'
          });
      }

      // var county = new L.GeoJSON(datasets[1], {
      //   style: style,
      //   onEachFeature: onEachFeature
      // }).addTo(mymap);
      // mymap.fitBounds(county.getBounds());

      var sites = new L.GeoJSON(datasets[1], {
        style: style,
        onEachFeature: onEachFeature,
        // onEachFeature: function(feature, layer) {
        //   layer.bindPopup('<b>Site Name: </b>' + feature.properties.usgs_site)
        // },
        pointToLayer: function(feature, latlng) {
          return L.marker(latlng, {
            icon: L.divIcon({
              className: 'map fas fa-tachometer-alt blinking',
            })
          });
        },
      }).addTo(mymap);

      var sampleSites = new L.GeoJSON(datasets[3], {
        style: sampleStyle,
        onEachFeature: sampleOnEachFeature,
        // onEachFeature: function(feature, layer) {
        //   layer.bindPopup('<b>Site Name: </b>' + feature.properties.usgs_site)
        // },

        pointToLayer: function(feature, latlng) {
          return L.marker(latlng, {
            icon: L.divIcon({
              className: 'map fas fa-vials blinking',
            })
          });
        },
      });

      var weatherSites = new L.GeoJSON(datasets[8], {
        style: weatherStyle,
        onEachFeature: weatherOnEachFeature,
        // onEachFeature: function(feature, layer) {
        //   layer.bindPopup('<b>Site Name: </b>' + feature.properties.usgs_site)
        // },

        pointToLayer: function(feature, latlng) {
          return L.marker(latlng, {
            icon: L.divIcon({
              className: 'map fas fa-cloud-sun-rain blinking',
            })
          });
        },
      });




      $("#hint").on("click", function() {
        gage1Counts(gage1);
        chart.load({
          unload: true,
          columns: [t, gage1.wt],
        });

        $("#hint").text("Click on map to review county trend.");

      });


      function onMapClick(e) {
        $("#hint").click();
      }

      mymap.on('click', onMapClick);

      gage1Counts(gage1);
      sample1Counts(sampleLoc1);
      varsCounts(weatherVars);
      chartColor = 'white'

      function annualUpdate(d) {
        var currentDate = new Date(d.x.toString());
        var currentYear = 2020;
        $("#year").text(d.x);

        var start = currentYear.toString() + "-01-01";
        var end = currentYear.toString() + "-12-31";





        var ticks = [];
        start = new Date(start.toString());
        end = new Date(end.toString());

        s = start.getTime();
        e = end.getTime();
        breaks = 5;
        interval = Math.floor(e - s) / breaks
        ticks = [];
        for (var j = 0; j < breaks; j++) {
          ticks.push(new Date(s + interval * j))
        }
        ticks.push(end);

        chart.internal.config.axis_x_tick_values = ticks;
        // chart.flush();




        chart.zoom([new Date(start.toString()), new Date(end.toString())]);
      }

var padTop = 10;
var padRight = 20;
// var padSide = 30;
      // gage chart
      chart = c3.generate({
        size: {
          height: 280,

        },
        data: {
          x: "Date",
          columns: [t, gage1.wt2020, gage1.wt2021],
          // onmouseover: annualUpdate,
          type: 'line',
        },
        // color: {
        //   pattern: [chartColor]
        // },
        subchart: {
          show: true,
          axis: {
            x: {
              show: false
            }
          },
          size: {
            height: 15
          },
        },
        padding: {
          // bottom: 10,
          top: padTop,
          right: padRight,
          // left: padSide,
        },
        axis: {
          x: {
            type: "timeseries",
            tick: {
              format: "%b %d",
              centered: true,
              fit: true,
              count: 20
            }
          },
          y: {
            label: {
              text: 'Water temp (deg C)',
              position: 'outer-middle'
            },
            min: 0,
            padding: {
              bottom: 0
            },
            type: 'linear',
            tick: {
              format: d3.format(".2s"),

              count: 5,
              // values: [0,5000,10000,15000]
            }
          }
        },
        point: {
          r: 0,
          focus: {
            expand: {
              r: 10
            }
          }
        },
        zoom: {
          // rescale: true,
          enabled: true,
          type: "scroll",
        },
        tooltip: {
          linked: true,
        },
        legend: {
          enabled: false,
        },
        bindto: "#gage-chart"
      });


      // sample algae chart
      sampleChart = c3.generate({
        size: {
          height: 280,

        },
        data: {
          x: "Date",
          columns: [wst2016, sampleLoc1.a2016, sampleLoc1.a2017, sampleLoc1.a2018, sampleLoc1.a2019],
          type: 'scatter',
        },
        color: {
          // pattern: [chartColor]
        },
        subchart: {
          show: true,
          axis: {
            x: {
              show: false
            }
          },
          size: {
            height: 15
          },
          onbrush: function(d) {
            toxinChart.zoom(sampleChart.zoom());
            nitrateChart.zoom(sampleChart.zoom());
          }
        },
        padding: {
          // bottom: 10,
          top: padTop,
          right: padRight,
          // left: padSide,
        },
        axis: {
          x: {
            type: "timeseries",
            tick: {
              format: "%b %d",
              centered: true,
              fit: true,
              count: 20
            }
          },
          y: {
            label: {
              text: 'Biovolume (um3\mL)',
              position: 'outer-middle'
            },
            min: 0,
            padding: {
              bottom: 0
            },
            type: 'linear',
            tick: {
              format: d3.format(".2s"),
              count: 5,
            }
          }
        },
        point: {
          r: 3,
          focus: {
            expand: {
              r: 10
            }
          }
        },
        zoom: {
          // rescale: true,+
          enabled: true,
          type: "scroll",
          onzoom: function(d) {
            toxinChart.zoom(sampleChart.zoom());
            nitrateChart.zoom(sampleChart.zoom());
          }
        },
        tooltip: {
          linked: true,
        },
        legend: {
          enabled: false,
        },
        bindto: "#sample-chart"
      });
      // toxin chart
      toxinChart = c3.generate({
        size: {
          height: 220,

        },
        data: {
          x: "Date",
          columns: [wst2016, sampleLoc1.t2016, sampleLoc1.t2017, sampleLoc1.t2018, sampleLoc1.t2019],
          type: 'scatter',
        },
        // color: {
        //   pattern: [chartColor]
        // },
        padding: {
          top: padTop,
              right: padRight,
          // left: padSide,
        },
        axis: {
          x: {
            type: "timeseries",
            tick: {
              format: "%b %d",
              centered: true,
              fit: true,
              count: 20
            }
          },
          y: {
            label: {
              text: 'Microcystin observed (ppb)',
              position: 'outer-middle'
            },
            min: 0,
            padding: {
              bottom: 0
            },
            type: 'linear',
            // tick: {
            //   format: d3.format(".2s"),
            //   count: 5,
            // }
          }
        },
        point: {
          r: 3,
          focus: {
            expand: {
              r: 10
            }
          }
        },
        zoom: {
          // rescale: true,+
          enabled: true,
          type: "scroll",
        },
        tooltip: {
          linked: true,
        },
        legend: {
          enabled: false,
        },
        bindto: "#toxin-chart"
      });
      // toxin chart
      nitrateChart = c3.generate({
        size: {
          height: 220,
        },
        data: {
          x: "Date",
          columns: [wst2016, sampleLoc1.n2016, sampleLoc1.n2017, sampleLoc1.n2018, sampleLoc1.n2019],
          type: 'scatter',
        },
        // color: {
        //   pattern: [chartColor]
        // },
        padding: {
          top: padTop,
              right: padRight,
          // left: padSide,
        },
        axis: {
          x: {
            type: "timeseries",
            tick: {
              format: "%b %d",
              centered: true,
              fit: true,
              count: 20
            }
          },
          y: {
            label: {
              text: 'Total nitrates observed (mg/L)',
              position: 'outer-middle'
            },
            min: 0,
            padding: {
              bottom: 0
            },
            type: 'linear',
            // tick: {
            //   format: d3.format(".2s"),
            //   count: 5,
            // }
          }
        },
        point: {
          r: 3,
          focus: {
            expand: {
              r: 10
            }
          }
        },
        zoom: {
          // rescale: true,+
          enabled: true,
          type: "scroll",
        },
        tooltip: {
          linked: true,
        },
        legend: {
          enabled: false,
        },
        bindto: "#nitrate-chart"
      });
      // weather chart
      precipChart = c3.generate({
        size: {
          height: 280,

        },
        data: {
          x: "Date",
          columns: [wt2020, weatherVars.p2020, weatherVars.p2021],
          type: 'line',
        },
        // color: {
        //   pattern: [chartColor]
        // },
        subchart: {
          show: true,
          axis: {
            x: {
              show: false
            }
          },
          size: {
            height: 15
          },
          onbrush: function(d) {
            aitTempChart.zoom(precipChart.zoom());
          }
        },

        padding: {
          top: padTop,
          right: padRight,
          // left: padSide,
        },
        axis: {
          x: {
            type: "timeseries",
            tick: {
              format: "%b %d",
              centered: true,
              fit: true,
              count: 20
            }
          },
          y: {
            label: {
              text: 'Avg. precipitation (mL)',
              position: 'outer-middle'
            },
            min: 0,
            padding: {
              bottom: 0
            },
            type: 'linear',
            tick: {
              format: d3.format(".2s"),

              count: 5,
              // values: [0,5000,10000,15000]
            }
          }
        },
        point: {
          r: 0,
          focus: {
            expand: {
              r: 10
            }
          }
        },
        zoom: {
          // rescale: true,+
          enabled: true,
          type: "scroll",
          onzoom: function(d) {
            aitTempChart.zoom(precipChart.zoom());
            // step();
          }
        },
        tooltip: {
          linked: true,
        },
        legend: {
          enabled: false,
        },
        bindto: "#precip-chart"
      });
      // Air Temp Chart
      aitTempChart = c3.generate({
        size: {
          height: 220,
        },
        data: {
          x: "Date",
          columns: [wt2020, weatherVars.a2020, weatherVars.a2021],
          type: 'line',
        },
        // color: {
        //   pattern: [chartColor]
        // },
        padding: {
          top: padTop,
          right: padRight,
          // left: padSide,
        },
        axis: {
          x: {
            type: "timeseries",
            tick: {
              format: "%b %d ",
              centered: true,
              fit: true,
              count: 20
            }
          },
          y: {
            label: {
              text: 'Avg. air temp (deg C)',
              position: 'outer-middle'
            },
            min: 0,
            padding: {
              bottom: 0
            },
            type: 'linear',
            tick: {
              format: d3.format(".2s"),

              count: 5,
              // values: [0,5000,10000,15000]
            }
          }
        },
        point: {
          r: 0,
          focus: {
            expand: {
              r: 10
            }
          }
        },
        zoom: {
          enabled: {
            type: "drag"
          },
        },
        tooltip: {
          linked: true,
        },
        legend: {
          enabled: false,
        },
        bindto: "#airTemp-chart"
      });



      // $(document).ready(function() {
      //   $('input[type=radio]').change(function() {
      //     var t = ["Date"];
      //     var water_temp = ["Water Temperature"];
      //     if ($('#inlineRadioG2').is(':checked')) {
      //       var siteSelect = {
      //         name: "14179000",
      //         wt: water_temp,
      //       }
      //     } else if ($('#inlineRadioG1').is(':checked')) {
      //       var siteSelect = {
      //         name: "14178000",
      //         wt: water_temp,
      //       }
      //     } else if ($('#inlineRadioG3').is(':checked')) {
      //       var siteSelect = {
      //         name: "14180300",
      //         wt: water_temp,
      //       }
      //     } else if ($('#inlineRadioG4').is(':checked')) {
      //       var siteSelect = {
      //         name: "14181500",
      //         wt: water_temp,
      //       }
      //     }
      //     siteCounts(siteSelect);
      //     chart.load({
      //       unload: true,
      //       columns: [siteSelect.wt],
      //     });
      //   });
      // });
      //
      // $(document).ready(function() {
      //   $('input[type=radio]').change(function() {
      //     var wst = ["Date"];
      //     var algae = ["Algae"];
      //     if ($('#inlineRadio12').is(':checked')) {
      //       var sampleSiteSelect = {
      //         name: "Log Boom",
      //         a: algae,
      //       }
      //     } else if ($('#inlineRadio22').is(':checked')) {
      //       var sampleSiteSelect = {
      //         name: "Heater",
      //         a: algae,
      //       }
      //     } else if ($('#inlineRadio32').is(':checked')) {
      //       var sampleSiteSelect = {
      //         name: "Blowout",
      //         a: algae,
      //       }
      //     }
      //     sampleSiteCounts(sampleSiteSelect);
      //     sampleChart.load({
      //       unload: true,
      //       columns: [sampleSiteSelect.a],
      //     });
      //   });
      // });

      $("#weather-tab").on("click", function() {
        // Remove Map Layers
        mymap.removeLayer(sites);
        mymap.removeLayer(sampleSites);
        mymap.removeLayer(weatherSites);
        // Add selected geo layer for selected year
        mymap.addLayer(weatherSites);
        mymap.fitBounds(lakeBounds);




      });
      $("#stream-tab").on("click", function() {
        // Remove Map Layers
        mymap.removeLayer(sites);
        mymap.removeLayer(sampleSites);
        mymap.removeLayer(weatherSites);
        // Add selected geo layer for selected year
        mymap.addLayer(sites);
        mymap.fitBounds(lakeBounds)

      });
      $("#sample-tab").on("click", function() {
        // Remove Map Layers
        mymap.removeLayer(sites);
        mymap.removeLayer(sampleSites);
        mymap.removeLayer(weatherSites);
        // Add selected geo layer for selected year
        mymap.addLayer(sampleSites);
        mymap.fitBounds(lakeBounds)

      });


      $("#14179000").on("click", function() {
        $("#gageDropdown").text("BREITENBUSH R ABV FRENCH CR NR DETROIT, OR");

        var t = ["Date"];
        var t2020 = ["Date"];
        var t2021 = ["Date"];
        var water_temp = ["Water Temperature"];
        var water_temp2020 = ["2020"];
        var water_temp2021 = ["2021"];
        // var negTests = ["Negative Tests"];
        var siteSelect = {
          name: "14179000",
          wt: water_temp,
          wt2020: water_temp2020,
          wt2021: water_temp2021,
        }

        siteCounts(siteSelect);


        chart.load({
          unload: true,
          columns: [siteSelect.wt2020, siteSelect.wt2021],
        });
      });

      $("#14178000").on("click", function() {
        $("#gageDropdown").text("NO SANTIAM R BLW BOULDER CRK, NR DETROIT, OR");

        var t = ["Date"];
        var t2020 = ["Date"];
        var t2021 = ["Date"];
        var water_temp = ["Water Temperature"];
        var water_temp2020 = ["2020"];
        var water_temp2021 = ["2021"];
        // var negTests = ["Negative Tests"];
        var siteSelect = {
          name: "14178000",
          wt: water_temp,
          wt2020: water_temp2020,
          wt2021: water_temp2021,
        }

        siteCounts(siteSelect);


        chart.load({
          unload: true,
          columns: [siteSelect.wt2020, siteSelect.wt2021],
        });
      });

      $("#14180300").on("click", function() {
        $("#gageDropdown").text("BLOWOUT CREEK NEAR DETROIT, OR");

        var t = ["Date"];
        var t2020 = ["Date"];
        var t2021 = ["Date"];
        var water_temp = ["Water Temperature"];
        var water_temp2020 = ["2020"];
        var water_temp2021 = ["2021"];
        // var negTests = ["Negative Tests"];
        var siteSelect = {
          name: "14180300",
          wt: water_temp,
          wt2020: water_temp2020,
          wt2021: water_temp2021,
        }

        siteCounts(siteSelect);


        chart.load({
          unload: true,
          columns: [siteSelect.wt2020, siteSelect.wt2021],
        });
      });

      $("#14181500").on("click", function() {
        $("#gageDropdown").text("NORTH SANTIAM RIVER AT NIAGARA, OR");

        var t = ["Date"];
        var t2020 = ["Date"];
        var t2021 = ["Date"];
        var water_temp = ["Water Temperature"];
        var water_temp2020 = ["2020"];
        var water_temp2021 = ["2021"];
        // var negTests = ["Negative Tests"];
        var siteSelect = {
          name: "14181500",
          wt: water_temp,
          wt2020: water_temp2020,
          wt2021: water_temp2021,
        }

        siteCounts(siteSelect);


        chart.load({
          unload: true,
          columns: [siteSelect.wt2020, siteSelect.wt2021],
        });
      });

      $("#Log_Boom").on("click", function() {
        $("#sampleDropdown").text("Log Boom");

        var wst = ["Date"];
        var wst2016 = ["Date"];
        var wst2017 = ["Date"];
        var wst2018 = ["Date"];
        var wst2019 = ["Date"];
        var wstt = ["Date"];
        var wstt2016 = ["Date"];
        var wstt2017 = ["Date"];
        var wstt2018 = ["Date"];
        var wstt2019 = ["Date"];
        var wsnt = ["Date"];
        var wsnt2016 = ["Date"];
        var wsnt2017 = ["Date"];
        var wsnt2018 = ["Date"];
        var wsnt2019 = ["Date"];
        var algae = ["Algae"];
        var algae2016 = ["2016"];
        var algae2017 = ["2017"];
        var algae2018 = ["2018"];
        var algae2019 = ["2019"];
        var toxin = ["Toxins"];
        var toxin2016 = ["2016"];
        var toxin2017 = ["2017"];
        var toxin2018 = ["2018"];
        var toxin2019 = ["2019"];
        var nitrate = ["Total Nitrate"];
        var nitrate2016 = ["2016"];
        var nitrate2017 = ["2017"];
        var nitrate2018 = ["2018"];
        var nitrate2019 = ["2019"];
        // var negTests = ["Negative Tests"];
        var sampleSiteSelect = {
          name: "Log_Boom",
          a: algae,
          a2016: algae2016,
          a2017: algae2017,
          a2018: algae2018,
          a2019: algae2019,
          t: toxin,
          t2016: toxin2016,
          t2017: toxin2017,
          t2018: toxin2018,
          t2019: toxin2019,
          n: nitrate,
          n2016: nitrate2016,
          n2017: nitrate2017,
          n2018: nitrate2018,
          n2019: nitrate2019,
        }

        sampleSiteCounts(sampleSiteSelect);


        sampleChart.load({
          unload: true,
          columns: [sampleLoc.a2016, sampleLoc.a2017, sampleLoc.a2018, sampleLoc.a2019],
        });
        toxinChart.load({
          unload: true,
          columns: [sampleLoc.t2016, sampleLoc.t2017, sampleLoc.t2018, sampleLoc.t2019],
        });
        nitrateChart.load({
          unload: true,
          columns: [sampleLoc.n2016, sampleLoc.n2017, sampleLoc.n2018, sampleLoc.n2019],
        });
      });

      $("#Heater").on("click", function() {
        $("#sampleDropdown").text("Heater");

        var wst = ["Date"];
        var wst2016 = ["Date"];
        var wst2017 = ["Date"];
        var wst2018 = ["Date"];
        var wst2019 = ["Date"];
        var wstt = ["Date"];
        var wstt2016 = ["Date"];
        var wstt2017 = ["Date"];
        var wstt2018 = ["Date"];
        var wstt2019 = ["Date"];
        var wsnt = ["Date"];
        var wsnt2016 = ["Date"];
        var wsnt2017 = ["Date"];
        var wsnt2018 = ["Date"];
        var wsnt2019 = ["Date"];
        var algae = ["Algae"];
        var algae2016 = ["2016"];
        var algae2017 = ["2017"];
        var algae2018 = ["2018"];
        var algae2019 = ["2019"];
        var toxin = ["Toxins"];
        var toxin2016 = ["2016"];
        var toxin2017 = ["2017"];
        var toxin2018 = ["2018"];
        var toxin2019 = ["2019"];
        var nitrate = ["Total Nitrate"];
        var nitrate2016 = ["2016"];
        var nitrate2017 = ["2017"];
        var nitrate2018 = ["2018"];
        var nitrate2019 = ["2019"];
        // var negTests = ["Negative Tests"];
        var sampleSiteSelect = {
          name: "Heater",
          a: algae,
          a2016: algae2016,
          a2017: algae2017,
          a2018: algae2018,
          a2019: algae2019,
          t: toxin,
          t2016: toxin2016,
          t2017: toxin2017,
          t2018: toxin2018,
          t2019: toxin2019,
          n: nitrate,
          n2016: nitrate2016,
          n2017: nitrate2017,
          n2018: nitrate2018,
          n2019: nitrate2019,
        }

        sampleSiteCounts(sampleSiteSelect);


        sampleChart.load({
          unload: true,
          columns: [sampleLoc.a2016, sampleLoc.a2017, sampleLoc.a2018, sampleLoc.a2019],
        });
        toxinChart.load({
          unload: true,
          columns: [sampleLoc.t2016, sampleLoc.t2017, sampleLoc.t2018, sampleLoc.t2019],
        });
        nitrateChart.load({
          unload: true,
          columns: [sampleLoc.n2016, sampleLoc.n2017, sampleLoc.n2018, sampleLoc.n2019],
        });
      });

      $("#Blowout").on("click", function() {
        $("#sampleDropdown").text("Blowout");

        var wst = ["Date"];
        var wst2016 = ["Date"];
        var wst2017 = ["Date"];
        var wst2018 = ["Date"];
        var wst2019 = ["Date"];
        var wstt = ["Date"];
        var wstt2016 = ["Date"];
        var wstt2017 = ["Date"];
        var wstt2018 = ["Date"];
        var wstt2019 = ["Date"];
        var wsnt = ["Date"];
        var wsnt2016 = ["Date"];
        var wsnt2017 = ["Date"];
        var wsnt2018 = ["Date"];
        var wsnt2019 = ["Date"];
        var algae = ["Algae"];
        var algae2016 = ["2016"];
        var algae2017 = ["2017"];
        var algae2018 = ["2018"];
        var algae2019 = ["2019"];
        var toxin = ["Toxins"];
        var toxin2016 = ["2016"];
        var toxin2017 = ["2017"];
        var toxin2018 = ["2018"];
        var toxin2019 = ["2019"];
        var nitrate = ["Total Nitrate"];
        var nitrate2016 = ["2016"];
        var nitrate2017 = ["2017"];
        var nitrate2018 = ["2018"];
        var nitrate2019 = ["2019"];
        // var negTests = ["Negative Tests"];
        var sampleSiteSelect = {
          name: "Blowout",
          a: algae,
          a2016: algae2016,
          a2017: algae2017,
          a2018: algae2018,
          a2019: algae2019,
          t: toxin,
          t2016: toxin2016,
          t2017: toxin2017,
          t2018: toxin2018,
          t2019: toxin2019,
          n: nitrate,
          n2016: nitrate2016,
          n2017: nitrate2017,
          n2018: nitrate2018,
          n2019: nitrate2019,
        }

        sampleSiteCounts(sampleSiteSelect);


        sampleChart.load({
          unload: true,
          columns: [sampleLoc.a2016, sampleLoc.a2017, sampleLoc.a2018, sampleLoc.a2019],
        });
        toxinChart.load({
          unload: true,
          columns: [sampleLoc.t2016, sampleLoc.t2017, sampleLoc.t2018, sampleLoc.t2019],
        });
        nitrateChart.load({
          unload: true,
          columns: [sampleLoc.n2016, sampleLoc.n2017, sampleLoc.n2018, sampleLoc.n2019],
        });
      });

    });




    // Tab JS
    var triggerTabList = [].slice.call(document.querySelectorAll('#weather-tab'))
    triggerTabList.forEach(function(triggerEl) {
      var tabTrigger = new bootstrap.Tab(triggerEl)
      triggerEl.addEventListener('click', function(event) {
        event.preventDefault()
        tabTrigger.show()

      })
    })
    var triggerTabList = [].slice.call(document.querySelectorAll('#stream-tab'))
    triggerTabList.forEach(function(triggerEl) {
      var tabTrigger = new bootstrap.Tab(triggerEl)
      triggerEl.addEventListener('click', function(event) {
        event.preventDefault()
        tabTrigger.show()

      })
    })
    var triggerTabList = [].slice.call(document.querySelectorAll('#sample-tab'))
    triggerTabList.forEach(function(triggerEl) {
      var tabTrigger = new bootstrap.Tab(triggerEl)
      triggerEl.addEventListener('click', function(event) {
        event.preventDefault()
        tabTrigger.show()

      })
    })


    var today = new Date();

    var date = (today.getMonth() + 1) + '-' + today.getDate() + '-' + today.getFullYear();

    $("#date").text("Last update: " + date);

    /////////////////////////
    $(".leaflet-control-attribution")
      .css("background-color", "transparent")
      .css("color", "white")
      .html("Supported by <a href='https://www.clrwater.io/' target='_blank' style='color:white;''> ClearWater Analytica </a>");
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140689399-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-140689399-6');
  </script> -->


</body>

</html>
